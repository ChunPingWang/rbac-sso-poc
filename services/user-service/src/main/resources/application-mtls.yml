# ==============================================================================
# User Service - mTLS Configuration
#
# 說明：啟用雙向 TLS 認證的配置檔
# 啟用方式：SPRING_PROFILES_ACTIVE=mtls 或 --spring.profiles.active=mtls
#
# 憑證來源：cert-manager 自動掛載到 /etc/ssl/certs/
# ==============================================================================

server:
  port: 8082
  ssl:
    enabled: true
    # 服務端憑證 (來自 cert-manager)
    key-store-type: PEM
    key-store: /etc/ssl/certs/tls.crt
    key-store-password: ""
    # 私鑰
    key-alias: user-service
    certificate: /etc/ssl/certs/tls.crt
    certificate-private-key: /etc/ssl/certs/tls.key
    # 客戶端憑證驗證 (mTLS)
    client-auth: need  # need=強制, want=可選, none=不驗證
    trust-store-type: PEM
    trust-store: /etc/ssl/certs/ca.crt
    # TLS 版本限制
    protocol: TLS
    enabled-protocols: TLSv1.3,TLSv1.2

# 配置 WebClient 使用 mTLS 呼叫其他服務
spring:
  # SSL Bundle 配置 (Spring Boot 3.1+)
  ssl:
    bundle:
      pem:
        mtls-bundle:
          keystore:
            certificate: /etc/ssl/certs/tls.crt
            private-key: /etc/ssl/certs/tls.key
          truststore:
            certificate: /etc/ssl/certs/ca.crt

# 健康檢查需要透過 HTTPS
management:
  server:
    port: 8082
    ssl:
      enabled: true
      certificate: /etc/ssl/certs/tls.crt
      certificate-private-key: /etc/ssl/certs/tls.key
      trust-certificate: /etc/ssl/certs/ca.crt
      client-auth: none  # 健康檢查不需要客戶端憑證

logging:
  level:
    javax.net.ssl: DEBUG
    org.springframework.security: DEBUG
